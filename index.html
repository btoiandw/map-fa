<!doctype html>
<html lang="th">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á</title>

  <script src="https://static.line-scdn.net/liff/sdk/v2/liff.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
 
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />

  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      height: calc(100% - 70px);
    }

    .toolbar {
      font-size: 16px;
      height: 70px;
      padding: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
      background: #fff;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.12);
    }

    .btn {
      font-size: 16px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #888;
      background: #f7f7f7;
      cursor: pointer;
    }

    .btn.primary {
      background: #007bff;
      color: #fff;
      border-color: #0069d9;
    }

    .coords {
      font-size: 14px;
    }

    .flex-right {
      margin-left: auto;
      display: flex;
      gap: 6px;
    }

    .mo-mp {
      color: red;
      align-items: center;
      display: flex;
      text-align: center;
    }

    /* (‡πÇ‡∏Ñ‡πâ‡∏î CSS ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) */
    dialog {
      border: 1px solid #888;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    dialog::backdrop {
      background-color: rgba(0, 0, 0, 0.7);
    }
  </style>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

  <div class="toolbar">
    <div class="coords" id="coords">Lat: ‚Äî , Lng: ‚Äî </div>
    <div class="mo-mp">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</div>

    <div class="flex-right">
      <button class="btn primary" id="sendBtn">‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á</button>
    </div>
  </div>

  <button onclick="document.getElementById('dialogModal').showModal()">Open Dialog</button>
  <dialog id="dialogModal">
    <h2>Native Dialog Modal</h2>
    <p>This is a more modern approach to creating a modal.</p>
    <button onclick="document.getElementById('dialogModal').close()">Close</button>
  </dialog>

  <div id="map"></div>


  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
    const qs = (name, fallback) => new URL(location.href).searchParams.get(name) || fallback;

    const defaultLat = parseFloat(qs('lat', '16.48014010030842'));
    const defaultLng = parseFloat(qs('lng', '99.54879500429345'));
    const map = L.map('map').setView([defaultLat, defaultLng], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    const marker = L.marker([defaultLat, defaultLng], { draggable: true }).addTo(map);
    const coordsEl = document.getElementById('coords');

    function updateCoords(latlng) {
      coordsEl.textContent = `Lat: ${latlng.lat.toFixed(6)} , Lng: ${latlng.lng.toFixed(6)}`;
    }
    updateCoords(marker.getLatLng());

    marker.on('dragend', () => updateCoords(marker.getLatLng()));
    map.on('click', e => { marker.setLatLng(e.latlng); updateCoords(e.latlng); });

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF (‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢) ---

    // ** (‡πÄ‡∏£‡∏≤‡∏•‡∏ö 'accessToken' ‡πÅ‡∏•‡∏∞ 'apiUrl' ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß) **

    liff.init({
      // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡πÉ‡∏™‡πà LIFF ID ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***
      liffId: '2008381581-WY0BxEBw' 
    })
    .then(() => {
      // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ LIFF ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏° 'sendBtn'
      document.getElementById('sendBtn').onclick = async () => {
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!liff.isInClient()) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
          return;
        }

        const ll = marker.getLatLng();
        const googleMapsUrl = `https://maps.google.com/?q=${ll.lat},${ll.lng}`;

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö
        const messages = [
          {
            type: "text",
            text: `üìç ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!\nLat: ${ll.lat.toFixed(6)}\nLng: ${ll.lng.toFixed(6)}\n\n‡∏î‡∏π‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô Google Maps:\n${googleMapsUrl}`
          },
          {
            type: "location",
            title: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
            address: `Lat: ${ll.lat.toFixed(6)}, Lng: ${ll.lng.toFixed(6)}`,
            latitude: ll.lat,
            longitude: ll.lng
          }
        ];

        try {
          // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó
          await liff.sendMessages(messages);
          alert("‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
          
          // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á LIFF ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
          liff.closeWindow();
        } catch (err) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: " + err);
        }
      };
    })
    .catch((err) => {
      console.error("LIFF Initialization failed", err);
      alert("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + err.message);
    });

  </script>
</body>
</html>